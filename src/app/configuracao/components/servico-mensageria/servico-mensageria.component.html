<div class="row">
  <div class="col-12 col-md-12">
      <div class="header">
          <h3 id="title-mensageria" class="titulo">
              <span class="text-accent mr-3">Mensageria</span>
          </h3>
      </div>
  </div>
</div>
<cx-stepper id="passos-mensageria"
  [steps]="passos"
  [currentStep]="passo"
  [freeNavigation]="false"
  (changeStep)="changeStep($event)">
</cx-stepper>

<section id="secao-cadastro-consulta">

    <!---------------------------------------------->
    <!------- CONSULTA SERVIÇO MENSAGERIA ---------->
    <!---------------------------------------------->
    <div id="consulta-servico-mensageria" *ngIf="modoTela === modoListagem">

      <h5 id="title-lista-mensagens" class="mb-3">
        <span class="font-weight-bold">Mensagens</span>
      </h5>
      <span>
        Selecione na tabela a mensagem que deseja alterar ou excluir. Para novas mensagens, clique em "Nova Mensagem"
      </span>
      <div class="table-responsive mt-4">
        <table id="table-servico-mensageria" class="table">
          <thead>
            <tr>
              <th>Página de Exibição</th>
              <th>Ambiente</th>
              <th>Título</th>
              <th>Modelo</th>
              <th>Situação</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <ng-container id="container-mensageria">
              <tr *ngFor="let mensagem of mensagens | paginate: {itemsPerPage: 10, currentPage: page}; let i = index">
                <td>{{mensagem.nomeFuncionalidade}}</td>
                <td>
                  <span *ngIf="mensagem.ambientePiloto===ativo" class="badge  badge-accent">
                    Piloto
                  </span>
                  <span *ngIf="mensagem.ambienteNacional===ativo" class="badge  badge-accent">
                    Nacional
                  </span>
                  <span *ngIf="mensagem.ambientePrePiloto===ativo" class="badge  badge-accent">
                    PrePiloto
                  </span>
                </td>
                <td>{{mensagem.nome}}</td>

                <td>
                  <span *ngIf="mensagem.posicaoMensagem===posicaoPopup">
                    Pop-up
                  </span>
                  <span *ngIf="mensagem.posicaoMensagem===posicaoHeader">
                    Cabeçalho
                  </span>
                  <span *ngIf="mensagem.posicaoMensagem===posicaoToast">
                    Toast
                  </span>
                </td>

                    <td>
                      <span *ngIf="mensagem.posicaoMensagem===posicaoPopup">
                        Pop-up
                      </span>
                      <span *ngIf="mensagem.posicaoMensagem===posicaoHeader">
                        Cabeçalho
                      </span>
                      <span *ngIf="mensagem.posicaoMensagem===posicaoToast">
                        Toast
                      </span>
                    </td>

                    <td>
                      <span *ngIf="mensagem.situacao===situacaoAtivo">
                        <i class="fas fa-check fa-lg" title="{{mensagem.inicioExibicao}} até {{mensagem.fimExibicao}}"></i>
                      </span>
                      <span *ngIf="mensagem.situacao===situacaoSemExpiracao">
                        <i class="fas fa-check fa-lg" title="Sem Expiração"></i>
                      </span>
                      <span *ngIf="mensagem.situacao===situacaoExpirado">
                        <i class="fas fa-ban fa-lg" title="{{mensagem.inicioExibicao}} até {{mensagem.fimExibicao}}"></i>
                      </span>
                      <span *ngIf="mensagem.situacao===situacaoAgendado">
                        <i class="fas fa-calendar fa-lg" title="{{mensagem.inicioExibicao}} até {{mensagem.fimExibicao}}"></i>
                      </span>
                    </td>
                    <td id="td-acoes-conta" class="min-actions-button">
                      <div class="table-responsive">
                        <button id="btn-edit" class="btn btn-aux mr-2" title="Editar" (click)="abrirEdicao(mensagem)">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button id="btn-remover" class="btn btn-aux" title="Excluir" (click)="excluirMensagem(mensagem)">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
            </ng-container>
          </tbody>
        </table>
      </div>

      <div id="paginacao" class="float-right mt-2">
        <pagination-controls autoHide="true" responsive="true" previousLabel="Anterior" nextLabel="Próximo"
          (pageChange)="page=$event">
        </pagination-controls>
      </div>
    </div>

    <!---------------------------------------------->
    <!------- CADASTRO SERVIÇO MENSAGERIA ---------->
    <!---------------------------------------------->
    <div id="cadastro-servico-mensageria" *ngIf="modoTela === modoEdicao || modoTela === modoCadastro">

      <h5 id="title-lista-mensagens">
        <span class=" font-weight-bold mr-3">{{modoTela === modoEdicao ? "Alterar Mensagem" : "Adicionar Mensagem"}}</span>
      </h5>
      <form [formGroup]="dadosMensagemForm" class="mt-4">
        <div>
          <div class="row ml-0">
            <div class="form-group pl-0 pr-0 col-5 col-md-5 d-flex flex-column">
              <label id="label-funcionalidade" for="select-funcionalidade">
                Página de exibição
                <span class="text-danger">*</span>
              </label>
              <ng-container *ngIf="modoTela === modoEdicao">
                <input type="text" class="form-control" value="{{ mensagemAtual.nomeFuncionalidade }}" disabled>
              </ng-container>
              <ng-container *ngIf="modoTela === modoCadastro">
                <ng-select [items]="funcionalidades" [virtualScroll]="false" [searchFn]="customSearchFn"
                          placeholder="Selecione" class="custom" [ngModelOptions]="{standalone: true}"
                          [(ngModel)]="funcionalidade" (change)="onChangeFuncionalidade()">
                  <ng-template ng-label-tmp let-item="item">
                    {{item.nomeFuncionalidade}} ({{item.descricaoFuncionalidade}})
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-search="searchTerm" let-index="index">
                    {{item.nomeFuncionalidade}} ({{item.descricaoFuncionalidade}})
                  </ng-template>
                </ng-select>
              </ng-container>
            </div>
            <div class="form-group ml-3 pl-0 pr-0 col-3 col-md-3 d-flex flex-column">
              <label id="label-ambiente" for="select-funcionalidade">
                Ambiente
                <span class="text-danger">*</span>
              </label>
              <div class="row d-flex justify-content-around">
                <div class="form-group d-flex flex-column">
                  <div class="custom-checkbox pl-3">
                    <input type="checkbox" id="checkbox-ambiente-rascunho" class="custom-checkbox__input"
                      formControlName="chkAmbienteRascunho" (change)="onCheckRascunho($event.target.checked)" />
                    <label for="checkbox-ambiente-rascunho" class="checkbox__label custom-checkbox__label" id="label-checkbox-ambiente-rascunho">Rascunho</label>
                  </div>
                </div>
                <div class="form-group d-flex flex-column">
                  <div class="custom-checkbox pl-3">
                    <input type="checkbox" id="checkbox-ambiente-prePiloto" class="custom-checkbox__input"
                      formControlName="chkAmbientePrePiloto" (change)="onCheckAmbiente($event.target.checked)" />
                    <label for="checkbox-ambiente-prePiloto" class="checkbox__label custom-checkbox__label" id="label-checkbox-ambiente-prePiloto">PrePiloto</label>
                  </div>
                </div>
                <div class="form-group d-flex flex-column">
                  <div class="custom-checkbox pl-3">
                    <input type="checkbox" id="checkbox-ambiente-piloto" class="custom-checkbox__input"
                      formControlName="chkAmbientePiloto" (change)="onCheckAmbiente($event.target.checked)" />
                    <label for="checkbox-ambiente-piloto" class="checkbox__label custom-checkbox__label" id="label-checkbox-ambiente-piloto">Piloto</label>
                  </div>
                </div>
                <div class="form-group d-flex flex-column">
                  <div class="custom-checkbox pl-3">
                    <input type="checkbox" id="checkbox-ambiente-nacional" class="custom-checkbox__input"
                      formControlName="chkAmbienteNacional" (change)="onCheckAmbiente($event.target.checked)" />
                    <label for="checkbox-ambiente-nacional" class="checkbox__label custom-checkbox__label" id="label-checkbox-ambiente-nacional">Nacional</label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row ml-0">
            <div class="form-group pl-0 pr-0 col-8 col-md-8 d-flex flex-column">
              <label id="label-nome" for="nome"
                [class.label-invalid]="dadosMensagemForm.controls['nome'].invalid"
                [class.label-dirty]="dadosMensagemForm.controls['nome'].dirty">
                Título
                <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control" formControlName="nome">
            </div>
          </div>
          <div class="row ml-0">
            <div class="form-group pl-0 pr-0 col-8 col-md-8 d-flex flex-column">
              <label id="label-conteudo" for="conteudo"
                [class.label-invalid]="dadosMensagemForm.controls['conteudo'].invalid"
                [class.label-dirty]="dadosMensagemForm.controls['conteudo'].dirty">
                Mensagem
                <span class="text-danger">*</span>
              </label>
              <textarea type="text" class="form-control-borda" rows="3" cols="300" formControlName="conteudo"
                maxlength="3000"></textarea>
            </div>
          </div>

          <div class="row ml-0">
            <div class="custom-checkbox pl-3">
              <input type="checkbox" id="checkbox-com-prazo" class="custom-checkbox__input"
                formControlName="chkComPrazo" (change)="onCheckComPrazo($event.target.checked)"/>
              <label for="checkbox-com-prazo" class="checkbox__label custom-checkbox__label" id="label-checkbox-com-prazo">Esta mensagem terá prazo de validade</label>
            </div>
          </div>

          <div class="row ml-0" [hidden]="!isPrazo">
            <div class="form-group pl-0 col-2 col-md-2 d-flex flex-column">
              <label for="dataInicio">De:</label>
              <my-date-picker id="dataInicio" name="dataInicio" [options]="datePickerOptions" formControlName="dataInicio"></my-date-picker>
            </div>
            <div class="form-group pl-0 col-2 col-md-2 d-flex flex-column">
              <label for="horaInicio">Hora:</label>
              <input type="text" id="horaInicio" class="form-control" formControlName="horaInicio" placeholder="00:00" maxlength="5" appHoraMinMask>
            </div>
            <div class="form-group ml-3 pl-0 col-2 col-md-2 d-flex flex-column">
              <label for="dataFim">Até:</label>
              <my-date-picker id="dataFim" name="dataFim" [options]="datePickerOptions" formControlName="dataFim"></my-date-picker>
            </div>
            <div class="form-group pl-0 col-2 col-md-2 d-flex flex-column">
              <label for="horaFim">Hora:</label>
              <input type="text" id="horaFim" class="form-control" formControlName="horaFim" placeholder="00:00" maxlength="5" appHoraMinMask>
            </div>
          </div>

          <div class="row col-8">
            <div class="form-group pl-0 col-4 d-flex flex-column">
                <div class="card text-base">
                  <div class="card-header bg-dark">
                    <div class="custom-control custom-radio">
                      <input type="radio" class="custom-control-input" formControlName="radioPosicao"
                          name="radioPosicao" id="input-radioPosicao-um" value="{{posicaoPopup}}">
                      <label class="custom-control-label text-white" for="input-radioPosicao-um">Pop-up</label>
                    </div>
                  </div>
                  <div class="card-body">
                    <span class="text-danger">Mensagem impeditiva: esta opção bloqueia o fluxo da funcionalidade!</span><br/>
                    <span>Esse componente sobrepõe toda a página. Ao fechar a mensagem, o fluxo da funcionalidade será interrompido.</span><br/><br/>
                    <a class="m-0 p-0" (click)="exbirMsgExemplo(1)" title="Ver Exemplo">Ver Exemplo</a>
                  </div>
                </div>
            </div>
            <div class="form-group pl-0 col-4 d-flex flex-column">
              <div class="card text-base">
                <div class="card-header bg-dark">
                  <div class="custom-control custom-radio">
                    <input type="radio" class="custom-control-input" formControlName="radioPosicao"
                        name="radioPosicao" id="input-radioPosicao-dois" value="{{posicaoHeader}}">
                    <label class="custom-control-label text-white" for="input-radioPosicao-dois">Cabeçalho</label>
                  </div>
                </div>
                <div class="card-body">
                  <span>Esse componente apresenta a mensagem de forma localizada e estática. Um alerta será exibido no topo da página e não será necessário a interação do colaborador.</span><br/><br/>
                  <a class="m-0 p-0" (click)="exbirMsgExemplo(2)" title="Ver Exemplo">Ver Exemplo</a>
                </div>
              </div>
            </div>
            <div class="form-group pl-0 col-4 d-flex flex-column">
              <div class="card text-base">
                <div class="card-header bg-secondary">
                  <div class="custom-control custom-radio">
                    <input type="radio" class="custom-control-input" formControlName="radioPosicao" [attr.disabled]="true"
                        name="radioPosicao" id="input-radioPosicao-tres" value="{{posicaoToast}}">
                    <label class="custom-control-label text-white" for="input-radioPosicao-tres">Toast</label>
                  </div>
                </div>
                <div class="card-body text-muted">
                  <span>Esse componente apresenta uma mensagem flutuante na parte inferior da página. A interação com a mensagem é opcional ao colaborador.</span><br/><br/>
                  <a class="m-0 p-0" (click)="exbirMsgExemplo(3)" title="Ver Exemplo" disabled>Ver Exemplo</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!---------------------------------------------->
    <!------- COMPROVANTE/CONFIRMACAO     ---------->
    <!---------------------------------------------->
    <div id="comprovante-servico-mensageria" *ngIf="modoTela === modoComprovante">
      <div class="row mt-2" id="alerta-sucesso" *ngIf="comprovante">
        <div class="col">
          <div *ngIf="comprovante?.sucesso" class="alert alert-success-comprovante alert-dismissible fade show pt-2 pb-2 mb-0" role="alert">
            <p>
              <i class="fa fa-lg fa-check-circle" aria-hidden="true"></i>
              {{comprovante.mensagem}}
            </p>
          </div>
          <div *ngIf="!comprovante?.sucesso" class="alert alert-failure-comprovante alert-dismissible fade show pt-2 pb-2 mb-0" role="alert">
            <p>
              <i class="fa fa-lg fa-times-circle" aria-hidden="true"></i>
              {{comprovante.mensagem}}
            </p>
          </div>
        </div>
      </div>
      <h5 id="title-comprovante-mensagens">
        <span class=" font-weight-bold mr-3">Resumo da Operação</span>
      </h5>
      <div class="table-responsive col-xl-6 col-md-12 col-sm-12 col-6 mt-4">
        <table class="table table-striped">
          <tbody>
            <tr>
              <td>
                <span><strong>Titulo</strong></span>
              </td>
              <td>
                <span>{{comprovante?.titulo}}</span>
              </td>
            </tr>
            <tr>
              <td>
                <span><strong>Página</strong></span>
              </td>
              <td>
                <span>{{comprovante?.pagina}}</span>
              </td>
            </tr>
            <tr>
              <td>
                <span><strong>Ambiente</strong></span>
              </td>
              <td>
                <span>{{comprovante?.ambiente}}</span>
              </td>
            </tr>
            <tr>
              <td>
                <span><strong>Modelo</strong></span>
              </td>
              <td>
                <span>{{comprovante?.modelo}}</span>
              </td>
            </tr>
            <tr>
              <td>
                <span><strong>Período</strong></span>
              </td>
              <td>
                <span>{{comprovante?.periodo}}</span>
              </td>
            </tr>
            <tr>
              <td>
                <span><strong>Conteúdo</strong></span>
              </td>
              <td>
                <span>{{comprovante?.conteudo}}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

</section>

<section id="panel-button-cadastro" class="row ml-0 mt-4" >

  <div class="col-5 pl-0" *ngIf="modoTela === modoCadastro || modoTela === modoEdicao">
    <button type="button" class="btn btn-cancel mr-3" id="btn-voltar" (click)="voltar()">
      <span aria-hidden="true">
        <i class="fas fa-arrow-left"></i>
      </span> Voltar
    </button>
    <button id="button-confirmacao"  class="btn btn-accent" (click)="salvarMensagem()">
      <i class="fa fa-floppy-o fa-lg" aria-hidden="true"></i>Confirmar Operação
    </button>
  </div>

  <div class="col-3 pl-0" *ngIf="modoTela === modoListagem">
    <button id="button-cadastro"  class="btn btn-accent" (click)="abrirCadastro()">
      <i class="fa fa-plus-circle fa-lg" aria-hidden="true"></i> Cadastrar Mensagem
    </button>
  </div>

  <div class="col-5 pl-0" *ngIf="modoTela === modoComprovante">
    <button type="button" class="btn btn-cancel pl-0 mr-3" id="btn-inicio" (click)="voltar()">
      <span aria-hidden="true">
        <i class="fas fa-arrow-left"></i>
      </span> Inicio
    </button>
  </div>

</section>

